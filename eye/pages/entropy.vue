<i18n>
{
  "en": {
    "title": "Artchitect - entropy"
  },
  "ru": {
    "title": "Artchitect - —ç–Ω—Ç—Ä–æ–ø–∏—è"
  }
}
</i18n>

<template>
  <section>
    <h1 class="is-size-3">–î–∞—Ç—á–∏–∫ —ç–Ω—Ç—Ä–æ–ø–∏–∏</h1>
    <hr/>
    <p>
      –î–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å "—á—Ç–æ —Ä–∏—Å–æ–≤–∞—Ç—å?" - –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –Ω–∞–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏
      —É–Ω–∏–∫–∞–ª—å–Ω—ã–π seed-–Ω–æ–º–µ—Ä. –î–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞ (–ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π)
      –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –¥–∞—Ç—á–∏–∫—É —ç–Ω—Ç—Ä–æ–ø–∏–∏ (—Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑ –≤–µ–±-–∫–∞–º–µ—Ä—ã), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑ —Å–≤–µ—Ç–æ–≤–æ–≥–æ —à—É–º–∞ –ø–æ–ª—É—á–∏—Ç—å
      float64-—á–∏—Å–ª–æ. <b>float64-—á–∏—Å–ª–æ</b> - —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –∫–∞–∂–¥–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤ —Ä–∞–±–æ—Ç–µ Artchitect, –∞ –≤ –¥–µ–Ω—å –∏—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–µ—Å—è—Ç–∫–∏
      —Ç—ã—Å—è—á.
    </p>
    <hr/>
    <p>
      <b>–®–∞–≥ 1. –ò—Å—Ö–æ–¥–Ω—ã–π –∫–∞–¥—Ä (Source)</b>
      <br/>
      –≠–Ω—Ç—Ä–æ–ø–∏—è (–≤ —Ñ–æ—Ä–º–µ —Å–≤–µ—Ç–æ–≤–æ–≥–æ —à—É–º–∞) –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏–∑ —Ä–∞–∑–Ω–∏—Ü—ã –¥–≤—É—Ö —Å–æ—Å–µ–¥–Ω–∏—Ö –∫–∞–¥—Ä–æ–≤. –¢–µ–∫—É—â–∏–π –∫–∞–¥—Ä –≤–∏–¥–µ–Ω –Ω–∏–∂–µ, –µ–≥–æ
      —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –Ω–µ –∏–º–µ–µ—Ç
      –∑–Ω–∞—á–µ–Ω–∏—è. –ö—Ä–∞—Å–Ω—ã–º –æ—Ç–º–µ—á–µ–Ω–∞ –æ–±–ª–∞—Å—Ç—å, —Å –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Å–Ω–∏–º–∞—Ç—å—Å—è —Ñ–æ–Ω–æ–≤—ã–π —à—É–º.
    </p>
    <div class="has-text-centered">
      <img v-if="images.source !== null" :src="`data:image/jpeg;base64, ${images.source}`"
           alt="loading source stream"/>
    </div>
    <p>
      <b>–®–∞–≥ 2. –®—É–º (Noise)</b>
      <br/>
      –î–ª—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏ —Å–≤–µ—Ç–æ–≤–æ–≥–æ —à—É–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—ã—á–∏—Ç–∞–Ω–∏–µ –∫–∞–¥—Ä–æ–≤ (–∏–∑ —Ü–≤–µ—Ç–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –∫–∞–¥—Ä–∞ –≤—ã—á–∏—Ç–∞—é—Ç—Å—è —Ü–≤–µ—Ç–∞
      –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–∞–¥—Ä–∞). –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏ –∏ –µ—Å—Ç—å —Å–≤–µ—Ç–æ–≤–æ–π —à—É–º, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è. –í –≤–∏–∑—É–∞–ª—å–Ω–æ–º
      –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —à—É–º –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
    </p>
    <div class="has-text-centered">
      <img v-if="images.noise !== null" :src="`data:image/jpeg;base64, ${images.noise}`"
           style="height: 256px; width: 256px;"
           alt="loading noise stream"/>
    </div>
    <p>
      <b>–®–∞–≥ 3. –≠–Ω—Ç—Ä–æ–ø–∏—è - —Å–∂–∞—Ç–∏–µ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —à—É–º–∞ (Entropy)</b>
      <br/>
      –®—É–º —Å–∂–∏–º–∞–µ—Ç—Å—è –¥–æ –æ–±–ª–∞—Å—Ç–∏ 8x8 –ø–∏–∫—Å–µ–ª–µ–π –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —à–∫–∞–ª–µ –æ—Ç 0 –¥–æ
      255). –¢–∞–∫ –∏ –≤—ã–≥–ª—è–¥–∏—Ç <b>–±–∞–∑–æ–≤–∞—è —ç–Ω—Ç—Ä–æ–ø–∏—è</b>, –∫–∞–∫ –µ—ë –≤–∏–¥–∏—Ç –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä.
    </p>
    <div class="has-text-centered">

      <img v-if="images.shrink !== null" :src="`data:image/png;base64, ${images.shrink}`"
           style="width: 64px; height: 64px; image-rendering: pixelated;" alt="loading shrink stream"/>
    </div>
    <p><b>–®–∞–≥ 4. –ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —ç–Ω—Ç—Ä–æ–ø–∏—è (Choice)</b>
      <br/>
      –ß—Ç–æ–±—ã –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —Ä–∏—Å–æ–≤–∞–ª —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω—ã, –æ–Ω –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–±–æ—Ä–µ (–∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –∏–ª–∏ seed-–Ω–æ–º–µ—Ä–∞) –¥–æ–ª–∂–µ–Ω
      –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ (–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –≤—ã–±–∏—Ä–∞—Ç—å –æ—á–µ–Ω—å —Ä–∞–∑–Ω—ã–µ —Å–ª–æ–≤–∞ –∏–∑ —Å–ª–æ–≤–∞—Ä—è –∫–∞–∂–¥—ã–π —Ä–∞–∑,
      –Ω–µ—á–∞—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—è—è—Å—å).
      <br/>
      –ß—Ç–æ–±—ã
      –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ç–∞–∫—É—é —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —ç–Ω—Ç—Ä–æ–ø–∏—è –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –±–∏–Ω–∞—Ä–Ω–æ (–∫–∞–∂–¥—ã–π –±–∞–π—Ç –≤ —Ä–∏—Å—É–Ω–∫–µ —ç–Ω—Ç—Ä–æ–ø–∏–∏ –∑–µ—Ä–∫–∞–ª—å–Ω–æ
      –æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è). –ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —ç–Ω—Ç—Ä–æ–ø–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—á–µ–Ω—å —Å–ª—É—á–∞–π–Ω–æ–π –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ –≤—ã–±–∏—Ä–∞—Ç—å —Å–ª–æ–≤–∞
      –∏–∑ —Å–ª–æ–≤–∞—Ä—è.
    </p>
    <div class="has-text-centered">
      <img v-if="images.bytes !== null" :src="`data:image/png;base64, ${images.bytes}`"
           style="width: 64px; height: 64px; image-rendering: pixelated;" alt="loading bytes stream"/>
      <br/>
    </div>
    <p>
      <b>–®–∞–≥ 5. –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —á–∏—Å–ª–æ</b>
      <br/>
      –ö–∞–∂–¥—ã–π –ø–∏–∫—Å–µ–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –≤–∫–ª—é—á–µ–Ω, –∏–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω (–∑–Ω–∞—á–µ–Ω–∏–µ –µ–≥–æ —Ü–≤–µ—Ç–∞ –±–ª–∏–∂–µ –∫ –∫—Ä–∞—Å–Ω–æ–º—É –∏–ª–∏ –∫ —á—ë—Ä–Ω–æ–º—É). –ö–∞–∂–¥—ã–π
      –ø–∏–∫—Å–µ–ª—å - —ç—Ç–æ –æ–¥–∏–Ω –±–∏—Ç –∏–∑ 64-–±–∏—Ç–Ω–æ–≥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞ (uint64). –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø–æ—Å–ª–µ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è
      uint64 —á–∏—Å–ª–æ–º –Ω–∞ —à–∫–∞–ª–µ –æ—Ç 0 –¥–æ 18446744073709551615. –ü–æ–ª–æ–∂–µ–Ω–∏–µ —ç—Ç–æ–≥–æ —á–∏—Å–ª–∞ –Ω–∞ —à–∫–∞–ª–µ –∏ –µ—Å—Ç—å —Ç–æ—á–∫–∞ –≤—ã–±–æ—Ä–∞.
      –î–∞–ª–µ–µ —à–∫–∞–ª–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ float64-—á–∏—Å–ª–æ, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–µ–µ —à–∫–∞–ª—É –≤—ã–±–æ—Ä–∞ - —ç—Ç–æ –¥—Ä–æ–±–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 0.0 –¥–æ 1.0, –≥–¥–µ 0 -
      —Å–∞–º—ã–π –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ —Å–ø–∏—Å–∫–µ, 1.0 - –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç, 0.5 - –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–µ—Ä–µ–¥–∏–Ω–∞ —Å–ø–∏—Å–∫–∞.
      <br/>
      –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É —Ö–≤–∞—Ç–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö float64-—á–∏—Å–µ–ª, —á—Ç–æ–±—ã –ø—Ä–∏–Ω—è—Ç—å –≤—Å–µ —Ä–µ—à–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∏–¥–µ–∏ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–∏–Ω—ã.
    </p>
    <div class="has-text-centered">
      <span class="is-size-7" v-html="entropy.bytes ? entropy.bytes.match(/.{1,8}/g).join('<br/>') : '-'"></span><br/>
      <span>–í—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —à–∫–∞–ª–µ –æ—Ç 0.0 –¥–æ 1.0: <b>{{ entropy.float }}</b></span><br/>
    </div>

  </section>
</template>

<script>

import WsConnection from "~/utils/ws_connection";

export default {
  name: "entropy",
  data() {
    return {
      player: null,
      logPrefix: "üéÜ",
      status: {
        error: null,
        reconnecting: null,
      },
      maintenance: false,
      connection: null,
      images: {
        source: null,
        noise: null,
        shrink: null,
        bytes: null
      },
      entropy: {
        bytes: "",
        float: 0.0
      }
    }
  },
  head() {
    return {
      title: this.$t('title')
    }
  },
  mounted() {
    if (process.env.SOUL_MAINTENANCE === 'true') {
      this.maintenance = true
      return
    }
    this.connection = new WsConnection(process.env.WS_URL, this.logPrefix, ['entropy'], 100)
    this.connection.onmessage((channel, message) => {
      this.status.error = null
      this.status.reconnecting = null
      this.onMessage(channel, message)
    })
    this.connection.onerror((err) => {
      this.status.error = err
    })
    this.connection.onreconnecting((attempt, maxAttempts) => {
      console.log(`${this.logPrefix}: RECONNECTING ${attempt}/${maxAttempts}`)
      this.status.reconnecting = {attempt, maxAttempts}
    })
    this.connection.onopen(() => {
      this.status.reconnecting = null
      this.status.error = null
    })
    this.connection.onopen(() => {
      this.status.reconnecting = null
      this.status.error = null
      console.log(`${this.logPrefix}: connection established`)
    })
    this.connection.connect()
  },
  beforeDestroy() {
    if (!this.maintenance) {
      this.connection.close()
      this.connection = null
    }
  },
  methods: {
    onMessage(chan, msg) {
      if (!msg.Image) {
        return
      }

      if (msg.EntropyAnswer > 0) {
        this.entropy.bytes = msg.EntropyAnswerByte
        this.entropy.float = msg.EntropyAnswer
      }

      switch (msg.Phase) {
        case 'source':
          this.images.source = msg.Image
          break
        case 'noise':
          this.images.noise = msg.Image
          break
        case 'shrink':
          this.images.shrink = msg.Image
          break
        case 'bytes':
          this.images.bytes = msg.Image
          break
        default:
          console.warn(`new phase ${msg.Phase}`)
      }
    }
  }
}
</script>


<style scoped lang="scss">

</style>
